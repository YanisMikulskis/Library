# Library
Вот сложное задание по Python, которое включает различные аспекты программирования, такие как работа с данными, 
алгоритмы и объектно-ориентированное программирование:

Задание: Реализация системы управления библиотекой

Описание
Вам нужно создать систему управления библиотекой, которая будет поддерживать следующие функции:

Добавление, удаление и поиск книг в библиотеке.
Регистрация пользователей библиотеки.
Взятие и возврат книг пользователями.
Ведение учета выдачи книг и возвратов.
Генерация отчетов о текущем состоянии библиотеки.
Требования
Классы и объекты:

Класс Book с атрибутами: id, title, author, year, is_checked_out.
Класс User с атрибутами: id, name, email.
Класс Library с атрибутами и методами для управления книгами и пользователями.
Методы класса Library:

add_book(book: Book) - добавление книги.
remove_book(book_id: int) - удаление книги по ID.
find_book(book_id: int) - поиск книги по ID.
register_user(user: User) - регистрация пользователя.
checkout_book(book_id: int, user_id: int) - выдача книги пользователю.
return_book(book_id: int, user_id: int) - возврат книги пользователем.
general_report() - генерация отчета о текущем состоянии библиотеки.
Исключения и обработка ошибок:

Обработка случаев, когда пользователь пытается взять уже взятую книгу.
Обработка случаев, когда пользователь пытается вернуть книгу, которая ему не выдавалась.


## Readme

В данном проекте имеется две версии:
1) Обычная, работает через терминал
2) На Flask

В данном README будет инструкция для первой версии. Второй документ находится в папке с проектом Flask.

# ВАЖНО!
Инструкция, как запустить данный проект на Вашей машине.
Чтобы запустить мой гит репозиторий, нужно сначала разобраться с окружением.
Главное СНАЧАЛА создать окружение, а ПОТОМ клонировать репо.

Актуально для PyCharm.
Порядок подключения виртуального окружения:
1) Создаем пустую папку и открываем ее в терминале.
2) Создаем пустое окружение через pip. Я предпочитаю делать это через терминал (python3 -m venv имя_окружения)
3) Активируем окружение (source ./имя_окружения/bin/activate)
4) Клонируем мой репо (git clone [ssh ключ])
5) Переходим в репо и устанавливаем в него всё из файла requirements.txt (pip install -r requirements.txt)
6) Практика показывает, что при таком способе IDE сама предлагает выбрать интерпретатор из нее как стандартный для
   проекта. Если этого не случилось, нужно перейти в настройки выбора интерпретатора и сделать это вручную.
   Интерпретатор обязательно должен быть установлен из текущего окружения, иначе IDE не увидит установленные библиотеки.
7) Запускаем проекты.

После этого в коде будут использоваться все пакеты, установленные в виртуальное окружение.
## Стек

- Python > 3.11
- requests
- typing
- Flask
- SQlite 3
- PyCharm Professional
- macOS Sonoma ver.14.4.1
- Git
- 
## Лицензия

MIT

## Общее описание работы кода (инструкция)
## 1. Library.py (обычная версия)

Все приложение состоит из двух классов:

1) class library_db - создание базы данных


__init__


    Конструктор создания и подключения к БД
    Создаем базу данных с названием, которое указываем в name_database и подключаемся к ней

create_tables


    Метод создания таблиц БД.
    В нашей базе данных будет две таблицы:
    Users_db - таблица пользователей, которых зарегистрировали в библиотеке
    Library_db - таблица с книгами, т.е. сама библиотека
    Поля таблиц:
    Users_db имеет 3 поля - 
    id 
    имя 
    почта

    Library_db имеет 7 полей - 
    id 
    название книги
    автор книги
    год написания книги
    флажок типа bool, указывающий на руках книга или в библиотеке
    уникальный номер книги
    id пользователя который взял книгу и ЕСЛИ взял, иначе null
    Последнее поле связано с полем id таблицы Users_db связью Многие-к-одному 
    через поле user_book_id

    Один пользователь может взять много книг, но конкретная книга может быть
    только у одного пользователя

Создаем экземпляр класса library_DB и вызываем метод сreate_tables, создавая таблицы

2) class Library - основной класс для работы с БД

init

    Конструктор создания атрибутов. Создадим один атрибут self.DB для удобных манипуляций с БД

1.last_number

    Статичный метод. В данном методе мы извлекаем уникальный номер последней книги в БД и возвращаем этот номер, 
    увеличенный на единицу. Сделан для упорядоченного размещения новой книги в библиотеке.
2.add_book

    Метод добавления книги в библиотеку
    В начале выводим сообщение, что именно нужно сделать? Добавить случайную книгу из Сети, добавить книгу вручную
    или выйти в главное меню.
    1) Добавить случайную книгу
    Сначала определяемся, сколько случайных книг хотим добавить в библиотеку
    Далее введенное число отправляем в параметр функции make_books.
    make_books - функция, которую я написал в файле Book и откуда, собственно, она импортируется
    -------------
    Во вспомогательном файле Book имеется class Book.
    В этом классе в атрибутах (в init) мы определяем данные для книги:
    Название, автора, год написания
    Метод generic data отвечает за "сбор" из Сети данны для книги. Воспользуемся библиотекой request:
    Сохраняем в переменную url ссылку на раздел онлайн библиотеки, который выдает случайную книгу при нажатии на кнопку.
    Важно: ссылка у нас именно на страницу ПОСЛЕ нажатия кнопки. Т.е. мы перехватываем данные, по факту ее не нажимая
    Парсим html код страницы с помощью bs4 для удобной работы далее
    С помощью регулярного выражения извлекаем название книги со страницы, избавлясь от пробелов в конце, если они
    появляются.
    Через soup.find_all находим класс информации о книге и сохраняем в book_info
    Из book_info с помощью регулярного вырдания вытаскиваем Имя Фамилию (и отчество при наличии) автора
    Дальше находим год написания через поиск четырехзначного строчного числа, если год оказываетя пустым - делаем равным
    нулю (год написан не ко всем книгам)
    Сохраняем извлеченные данные- название книги, автора, год в список
    Дополнительно указываем магический метод str, если нам понадобится проверить, какие книги находит переход по ссылке
    make_books - функция запускающая generic_data столько раз, сколько мы указали в классе Library количество случайных 
    книг
    Каждая книга - это один список из трех элементов: названия, автора, года. Все эти списки мы отправлем в главный
    список all_book_data  и возвращаем этот список в методе add_book
    ------------
    Вернув список в наш метод, мы пересохраняем его в переменную all_book_data
    Запускаем цикл счетчик, равный количеству случайных книг
    В цикле создаем уникальный номера для книг. Если у нас таблица пустая (стат. метод last_number возвращает False),
    то даем первой книге номер 1000, иначе - берем номер, возвращаемый last_number (последний номер + 1)
    Создаем основной список для книги: распакованный возврат функции make_books(переменная all_book_data), 
    1(значение по умолчанию, означающее, что книга в библиотеке), уникальный номер)
    запускаем вспомогательную функцию query_insert с параметром, в который закидываем наш список. В этой функции 
    осуществляем вставку книги в строку базы данных. И коммитим, подтвердив изменения.
    Такой же алгоритм совершаем с каждой случайной книгой из списка all_book_data
    2) Добавить книгу вручную
    Вводим для книги название, автора, года. Уникальный номер дается по аналогии с предыдущим услвоием.
    Полный список для книги создается по аналогии с предыдущим условием
    Запускаем фукнция query_insert по аналогии с предыдущим условием
    3) Вернуться в командам
    перезапуск фукнции main() - "включалки" нашего приложения
    Если вводим что-то другое - получаем сообщение об ошибке и перезапускаем метод.
3.remove_book


    Метод удаления книги из библиотеки.
    Сначала водим id книги, которую требуется удалить.
    Удаляем книгу по id через sqlite запрос.
    Прописываем специальный запрос, позволяющий упорядоченно продолжать нумерацию id при добавлении новых книг
    Коммитим

4.find_book


    Метод поиска книги в библиотеке по названию
    Вводим название книги
    Находим соответствующую строку с книгой в библиотеке
    Вносим эту строку в отдельный список find_books
    Может возникнуть ситуация, когда название книги выгружается с пробелом после последней буквы
    В этом случае, книга по названию в базе не находится.
    Создаем условие, в котором если книга не находится, то мы к ее названию добавляем пробел и выводим в список.
    Если она не находится и в этом случае, то это значит, что книги вообще нет в библиотеке, выводим сообщение об этом
    и пеерезапускаем метод
    Если книга есть, то запускаем по ней цикл
    Присваем значение переменно availability значение в соответствии со статусом книги: на руках она или в библиотеке.
    Дальше идет вспомогательная функция exam_book - она выводит пользователя, который взял данную книгу (и если взял, 
    иначе - сообщение о том, что книга в библиотеке)
    В конце выводим все данные найденной книги
    
5.register_user


    Метод регистрации нового пользователя в библиотеку.
    Вводим имя, почту (почта вносится в соответствии с шаблоном в регулярном выржаении и условии по домену.
    Если почта введена правильно - заносим пользователя в таблицу Users_db


6.checkout_book

    Метод выдачи книги выбранному пользователю
    Вводим id выбранного пользователя
    Выбираем и создаем список с именем выбранного пользователя
    Вводим уникальный номер книги, которую мы хотим выдать пользователю
    Выбираем соответствующую книгу из библиотеки и заносим в список её foreign key
    Если список не пустой (в нем находится цифра) - значит книга на руках у пользователя,
    чей id находится в этом списке. Перезапускаем метод и вводим омер другой книги
    Иначе прописываем id выбранного пользователя в foreign key выбранной книги, тем самым соединяя их связь многие к
    одному
    Коммитим
7.return_book


    Метод возврата книги в библиотеку пользователем
    Вводим id пользователя, который возвращает книгу в библиотеку.
    Находим его имя и id в таблице по введенному выше id
    Сохраняем в переменную эти данные
    Выбираем данный книг из библиотеки, у которые Foreign key совпадает
    с id пользователя
    Таким образом получим все книги, которые взял пользователь
    Создадим список уникальных номеров книг, которые взял пользователь
    Пишем ноер книги, которую возвращает пользователь и, если она у него есть, внешний
    ключ этой книги обнуляется
    Выводим информацию о о том, что пользователь вернул книгу.
    
    
8.checkout_report


    Метод создания отчета о книгах на руках или о количестве книг, которые находятся в библиотеке
    Выбираем все книги таблицы
    Выводим их в отдельный список
    Создаем список книг, которые на руках
    В зависимости от значения параметра for_return выводим соответствующую информацию

9.return_report


    Метод создания отчета о книгах библиотеке.
    Вызываем предыдущий метод с параметром for_return=True

10.general_report

    Метод, создающий общий, главный отчет о состоянии библиотеки, пользователях и книгах, которые они взяли

Для запуска вышеизложенных методов я сохраняю их в словарь, где ключом является порядковый номер, а значением анонимная
функция лямбда, вызывающая соответствующий метод
В функции main у нас есть цикл while, содержащий командное меню и вызов соответствующего метода по ключу,
номер которого мы выбираем в меню


